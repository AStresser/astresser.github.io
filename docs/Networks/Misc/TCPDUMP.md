
# tcpdump

**Tcpdump** - утилита командной строки, позволяющая перехватывать и анализировать сетевой трафик на интерфейсах.

Утилита проверяет заголовоки пакетов TCP/IP и выводить их содержимое в одну строку до нажатия Ctrl+C.

Строка вывода включает в себя следующие составляющие:

- Метка времени Unix (**20: 58: 26.765637**).
- Протокол (**IP**).
- IP-источника и номер порта, IP-назначения и номер порта (**10.0.0.50.80** > **10.0.0.1.53181**).
- Флаги TCP (**Flags \[F.\]**):
	- **o S** - **SYN**, установление соединения.
	- **F** - **FIN**, завершение соединения.
	- **A** - **ACK**, подтверждение приема пакета.
	- **P** - **PUSH**, указывает получатель обрабатывать пакеты вместо их буферизации.
	- **R** - **RST**, разрыв связи.
- Порядковый номер данных в пакете (**seq 1**).
- Номер подтверждения (**ack 2**).
- Размер окна (**win 453**).
- Длина полезной нагрузки (**length 0**).

## Опции

Вывести интерфейсы:
```bash
tcpdump -D
tcpdump --list-interfaces
```

Указать интерфейс:
```bash
tcpdump -i eth1
```

Выводить больше информации:
```bash
tcpdump -v
tcpdump -vv
```

Отключить поиск имен DNS (по умолчанию пытается резолвить):
```
tcpdump -n
```

Выбрать количество перехватываем пакетов:
```
tcpdump -c 5
```

Читабельные временные метки:
```bash
tcpdump -tttt
```

## Фильтры

По порту:
```bash
tcpdump -i eth1 port 80
tcpdump -i eth1 src port 443
tcpdump -i eth1 dst port 52
```

По хостам:
```
tcpdump -i eth1 host 192.168.2.2
tcpdump -i eth1 dst host 192.168.2.3
tcpdump -i eth1 src host 192.168.2.4
```

По протоколу:
```
tcpdump -i eth1 udp/tcp/icmp
```

Фильтры можно комбинировать выражениями AND, OR, NOT:
```bash
tcpdump -i eth1 src 10.0.0.1 and dst port 80
```

## Сохранение в файл

Можно сохранить некоторое количество строк в pcap-файл:
```bash
tcpdump -i eth1 -c 10 -w dump.pcap
```

## Просмотр сведений о пакете

Чтобы посмотреть не только заголовок, но и содержимое:
```bash
tcpdump -c 1 -i eth1 -A port 80
```

В hex-формате:
```bash
tcpdump -c 1 -i eth1 -X port 80
```